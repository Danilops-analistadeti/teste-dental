<ng-template #loadingTpl>
  <div class="container h-100 d-flex align-items-center justify-content-center">
    <div class="row justify-content-center">
      <div class="col-auto">
        <ec-loading [active]="true"></ec-loading>
      </div>
    </div>
  </div>
</ng-template>

<div *ngIf="!isLoading; else loadingTpl">

  <div class="confirm-proposal__title">
    <span mat-dialog-title>Confirmar oferta?</span>
    <mat-icon class="close" mat-dialog-close>close</mat-icon>
  </div>

  <div class="confirm-proposal mb-2">
    <div class="confirm-proposal__header mb-3">
      <div class="confirm-proposal__header__container">
        <div>
          <span class="text-transform-capitalize confirm-proposal__header--title">Vendedor: </span>
          <span class="confirm-proposal__header--item">{{data?.companySellers}}</span>
        </div>
        <div class="mt-3 text-transform-capitalize">
          <div>
            <span class="confirm-proposal__header--title">Comprador: </span>
            <span class="confirm-proposal__header--item">{{data?.companyBuyers}}</span>
          </div>
        </div>
      </div>
    </div>

    <ec-detail-proposal [offerQuotation]="data?.offerQuotation">
      <div class="confirm-proposal__send">
        <span>{{data?.energyVolumeAverage | number}} MW méd</span>
        <span class="mb-2 mt-2">
          ({{data?.energyVolumeAverage | transformMwh: data.offerQuotation.startDate: data.offerQuotation.endDate |
          number}}
          MWh)
        </span>
      </div>
    </ec-detail-proposal>

    <div class="confirm-proposal__more-informations mt-4">
      <div class="my-2">
        <span>Data de pagamento: </span>
        <em>MS + {{data?.paymentBusinessDay}} {{data?.paymentDayType}}</em>
      </div>
      <div class="my-2" *ngIf="data.showRetusd">
        <span>Retusd: </span><em>R$ {{data?.retusd}} /MWh</em>
      </div>
      <div class="my-2">
        <span>{{data.priceType}}: </span><em>{{data?.price | currency }}
          /MWh</em>
      </div>
      <div class="my-2">
        <span>Indice de reajuste: </span>
        <em>{{indexerEnum[data?.indexer]}}</em>
      </div>
      <div class="my-2">
        <span>Sazonalização: </span>
        <em>{{getOfferCustomizationDescriptionInput(data?.minimumSeasonality, data?.maximumSeasonality)}}</em>
      </div>
      <div class="my-2">
        <span>Flexibilidade: </span>
        <em>{{getOfferCustomizationDescriptionInput(data?.minimumFlexibility, data?.maximumFlexibility)}}</em>
      </div>
      <div class="my-2">
        <span>Modulação: </span>
        <em>{{modulationEnum[data?.modulationType]}} -
          {{getOfferCustomizationDescriptionInput(data?.minimalModulation, data?.maximumModulation)}}</em>
      </div>
      <div class="my-2">
        <span>Garantia financeira: </span>
        <em>{{financialGuarantee}}</em>
      </div>
    </div>

    <div class="confirm-proposal__actions mt-3 mb-4">
      <ng-container *ngIf="offerStatusEnum[data?.offerType] !== 'Indicativa'; else offerTypeIndicative">
        <button class="confirm-proposal__actions--revised w-100" es-button (click)="openObservationModal()">
          Solicitar revisão
        </button>

        <button class="confirm-proposal--button w-100" es-button (click)="changeStatus(2)">
          Aceitar a oferta
        </button>
      </ng-container>

      <ng-template #offerTypeIndicative>
        <button class="confirm-proposal__actions--revised w-100" es-button (click)="openObservationModal()">
          Solicitar oferta firme
        </button>
      </ng-template>
    </div>

    <mat-slide-toggle (change)="changeFeedback()" [(ngModel)]="data?.offerQuotation.sendEmailWithPrice">
      Informar o preço para os demais ofertantes com feedback.
    </mat-slide-toggle>

    <hr />

    <div class="confirm-proposal__offer-valid mb-4">
      <span class="confirm-proposal__offer-valid--title">Validade da oferta</span>
      <span class="confirm-proposal__offer-valid--subtitle mt-2">{{data?.proposalExpiration | date: 'dd/MM/yyyy
        HH:mm'}}</span>
    </div>
  </div>
</div>