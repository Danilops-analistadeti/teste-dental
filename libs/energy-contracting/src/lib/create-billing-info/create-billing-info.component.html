<div class="billing-information">
  <div class="billing-information__title mb-4">
    <span class="billing-information__title--span">Informações de Faturamento</span>
    <mat-icon class="close" mat-dialog-close>close</mat-icon>
  </div>

  <form [formGroup]="billingInformationForm">
    <div class="row">
      <div class="col-12">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Título</mat-label>
          <input matInput formControlName="title" required autocomplete="off" id="title">
          <mat-error *ngIf="billingInformationForm.get('title').hasError('required')">
            Título é obrigatório
          </mat-error>
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Empresa</mat-label>
          <input type="text" matInput [formControl]="clientSearchControl" [matAutocomplete]="clientSearch">
          <mat-autocomplete #clientSearch="matAutocomplete" [displayWith]="displayFnClient" (optionSelected)="onSelectedClient($event)">
            <mat-option *ngFor="let option of clients; trackBy: trackByFnClient" [value]="option">
              {{option.name}}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Razão Social</mat-label>
          <input matInput formControlName="name" required autocomplete="off" id="name">
          <mat-error *ngIf="billingInformationForm.get('name').hasError('required')">
            Razão é obrigatório
          </mat-error>
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      <div class="col-6">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Cnpj</mat-label>
          <input matInput formControlName="cnpj" required autocomplete="off" id="cnpj" mask="00.000.000/0000-00" (focusout)="searchCompanyAddress()">
          <mat-error *ngIf="billingInformationForm.get('cnpj').hasError('required')">
            CNPJ é obrigatório
          </mat-error>
        </mat-form-field>
      </div>
      <div class="col-6">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Inscrição estatudal</mat-label>
          <input matInput formControlName="stateRecord" autocomplete="off" id="stateRecord">
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      <div class="col-6">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Banco</mat-label>
          <input type="text" matInput [formControl]="bankSearchControl" [matAutocomplete]="bankSearch">
          <mat-autocomplete #bankSearch="matAutocomplete" [displayWith]="displayFnBank" (optionSelected)="onSelectBank($event)">
            <mat-option *ngFor="let option of banks; trackBy: trackByFnBank" [value]="option">
              {{option.compe}} - {{option.shortName}}
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </div>
      <div class="col-6">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Agência</mat-label>
          <input matInput formControlName="agency" autocomplete="off" id="agency">
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      <div class="col-6">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Número da conta</mat-label>
          <input matInput formControlName="accountNumber" autocomplete="off" id="accountNumber">
        </mat-form-field>
      </div>
      <div class="col-6">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>Telefone</mat-label>
          <input matInput formControlName="phone" autocomplete="off" id="phone" mask="(00) 0 0000-0000||(00) 0000-0000">
        </mat-form-field>
      </div>
    </div>
    <div class="row">
      <div class="col-12">
        <mat-form-field appearance="outline" floatLabel="always">
          <mat-label>E-mail</mat-label>
          <mat-chip-list required #chipList aria-label="E-mails" formControlName="emails">
            <mat-chip *ngFor="let email of emails; trackBy: trackByFnEmail" [selectable]="selectable" [removable]="removable" (removed)="remove(email)">
              {{ email }}
              <mat-icon matChipRemove *ngIf="removable">cancel</mat-icon>
            </mat-chip>
            <input [matChipInputFor]="chipList" [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
              [matChipInputAddOnBlur]="addOnBlur" (matChipInputTokenEnd)="add($event)">
          </mat-chip-list>

          <mat-error *ngIf="billingInformationForm.get('emails').hasError('email')">
            E-mail inválido
          </mat-error>
        </mat-form-field>
      </div>
    </div>

    <ec-address formControlName="address"></ec-address>
  </form>

  <div mat-dialog-actions class="billing-information__actions mb-3" *ngIf="showActions">
    <div class="wrapper">
      <ng-content select="[actions]"></ng-content>
    </div>
    <div class="default">
      <button type="button" class="billing-information__actions__btn-cancel" es-button mat-dialog-close>
        cancelar
      </button>
      <button es-button [disabled]="invalidAddress || billingInformationForm?.invalid" (click)="createBillingInfo()"
        [ngClass]="{'disabled': invalidAddress || isLoading.submit || billingInformationForm?.invalid}">
        <ec-loading [active]="isLoading.submit" [height]="'50px'">salvar</ec-loading>
      </button>
    </div>
  </div>
</div>
